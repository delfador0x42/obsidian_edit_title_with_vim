/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var m=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var v=(a,s)=>{for(var e in s)m(a,e,{get:s[e],enumerable:!0})},g=(a,s,e,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of p(s))!E.call(a,t)&&t!==e&&m(a,t,{get:()=>s[t],enumerable:!(i=h(s,t))||i.enumerable});return a};var T=a=>g(m({},"__esModule",{value:!0}),a);var f={};v(f,{default:()=>u});module.exports=T(f);var n=require("obsidian"),u=class extends n.Plugin{constructor(){super(...arguments);this.inTitleMode=!1;this.vimModeClass="";this.editedTitle="";this.titleKeyHandler=null;this.titleInputHandler=null;this.currentTitleEl=null}async onload(){console.log("Vim Title Edit: Loading plugin"),this.registerDomEvent(document,"keydown",this.handleEditorKeydown.bind(this),!0);let e=i=>{var o;let t=i;this.vimModeClass=((o=t.detail)==null?void 0:o.mode)||"",console.log("Vim Title Edit: mode changed to",this.vimModeClass)};document.addEventListener("vim-mode-change",e),this.register(()=>document.removeEventListener("vim-mode-change",e)),this.addCommand({id:"focus-title",name:"Focus inline title",callback:()=>this.focusTitle()}),console.log("Vim Title Edit: Plugin loaded")}onunload(){console.log("Vim Title Edit: Plugin unloaded")}handleEditorKeydown(e){if(e.key!=="k")return;let t=e.target.closest(".cm-editor");if(!t)return;let o=t.querySelector(".cm-fat-cursor")!==null,l=t.querySelector(".cm-vimCursorLayer")!==null,d=o||l||this.vimModeClass==="normal";if(console.log("Vim Title Edit: k pressed, isVimNormal:",d,"hasFatCursor:",o,"hasVimCursor:",l,"vimModeClass:",this.vimModeClass),!d)return;let c=this.app.workspace.getActiveViewOfType(n.MarkdownView);if(!c)return;let r=c.editor.getCursor();console.log("Vim Title Edit: cursor at line",r.line),r.line===0&&(console.log("Vim Title Edit: intercepting k, focusing title"),e.preventDefault(),e.stopPropagation(),this.focusTitle())}focusTitle(){var d,c;console.log("Vim Title Edit: focusTitle() called");let e=this.app.workspace.getActiveViewOfType(n.MarkdownView);if(!e){console.log("Vim Title Edit: no MarkdownView found");return}let t=e.containerEl.querySelector(".inline-title");if(console.log("Vim Title Edit: titleEl found:",!!t),!t){new n.Notice("Inline title not found. Enable it in Settings > Editor > Show inline title");return}this.cleanupTitleHandlers(),this.currentTitleEl=t,this.editedTitle=((d=t.textContent)==null?void 0:d.trim())||"",this.inTitleMode=!0,console.log("Vim Title Edit: initial title value:",this.editedTitle),this.titleInputHandler=()=>{var r;this.editedTitle=((r=t.textContent)==null?void 0:r.trim())||"",console.log("Vim Title Edit: input, new value:",this.editedTitle)},this.titleKeyHandler=r=>{console.log("Vim Title Edit: keydown on title, key:",r.key),(r.key==="Escape"||r.key==="Enter")&&(console.log("Vim Title Edit: exit key pressed, saving:",this.editedTitle),r.preventDefault(),r.stopPropagation(),this.saveTitleValue(this.editedTitle),this.cleanupTitleHandlers(),this.returnToEditor())},t.addEventListener("input",this.titleInputHandler),t.addEventListener("keydown",this.titleKeyHandler,!0),console.log("Vim Title Edit: handlers attached to title element"),t.focus();let o=document.createRange();o.selectNodeContents(t),o.collapse(!1);let l=window.getSelection();l==null||l.removeAllRanges(),l==null||l.addRange(o),console.log("Vim Title Edit: title focused, activeElement:",(c=document.activeElement)==null?void 0:c.className)}cleanupTitleHandlers(){this.currentTitleEl&&this.titleKeyHandler&&this.currentTitleEl.removeEventListener("keydown",this.titleKeyHandler,!0),this.currentTitleEl&&this.titleInputHandler&&this.currentTitleEl.removeEventListener("input",this.titleInputHandler),this.titleKeyHandler=null,this.titleInputHandler=null,this.currentTitleEl=null,this.inTitleMode=!1}returnToEditor(){let e=this.app.workspace.getActiveViewOfType(n.MarkdownView);e&&(e.editor.focus(),e.editor.setCursor({line:0,ch:0}),this.inTitleMode=!1)}async saveTitleValue(e){var l;console.log("Vim Title Edit: saveTitleValue called with:",e);let i=this.app.workspace.getActiveViewOfType(n.MarkdownView);if(!(i!=null&&i.file)){console.log("Vim Title Edit: no view or file, returning");return}if(console.log("Vim Title Edit: newTitle =",e,", current basename =",i.file.basename),!e){new n.Notice("Title cannot be empty");return}if(e===i.file.basename){console.log("Vim Title Edit: title unchanged, skipping rename");return}let t=((l=i.file.parent)==null?void 0:l.path)||"",o=t?`${t}/${e}.md`:`${e}.md`;try{await this.app.fileManager.renameFile(i.file,o),new n.Notice(`Renamed to: ${e}`)}catch(d){new n.Notice(`Failed to rename: ${d}`)}}};
