/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var u=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var h=Object.prototype.hasOwnProperty;var g=(a,s)=>{for(var e in s)u(a,e,{get:s[e],enumerable:!0})},E=(a,s,e,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of f(s))!h.call(a,t)&&t!==e&&u(a,t,{get:()=>s[t],enumerable:!(i=p(s,t))||i.enumerable});return a};var v=a=>E(u({},"__esModule",{value:!0}),a);var w={};g(w,{default:()=>m});module.exports=v(w);var n=require("obsidian"),m=class extends n.Plugin{constructor(){super(...arguments);this.inTitleMode=!1;this.vimModeClass=""}async onload(){console.log("Vim Title Edit: Loading plugin"),this.registerDomEvent(document,"keydown",this.handleEditorKeydown.bind(this),!0),this.registerDomEvent(document,"keydown",this.handleTitleKeydown.bind(this));let e=i=>{var o;let t=i;this.vimModeClass=((o=t.detail)==null?void 0:o.mode)||"",console.log("Vim Title Edit: mode changed to",this.vimModeClass)};document.addEventListener("vim-mode-change",e),this.register(()=>document.removeEventListener("vim-mode-change",e)),this.addCommand({id:"focus-title",name:"Focus inline title",callback:()=>this.focusTitle()}),console.log("Vim Title Edit: Plugin loaded")}onunload(){console.log("Vim Title Edit: Plugin unloaded")}handleEditorKeydown(e){if(e.key!=="k")return;let t=e.target.closest(".cm-editor");if(!t)return;let o=t.querySelector(".cm-fat-cursor")!==null,r=t.querySelector(".cm-vimCursorLayer")!==null,l=o||r||this.vimModeClass==="normal";if(console.log("Vim Title Edit: k pressed, isVimNormal:",l,"hasFatCursor:",o,"hasVimCursor:",r,"vimModeClass:",this.vimModeClass),!l)return;let c=this.app.workspace.getActiveViewOfType(n.MarkdownView);if(!c)return;let d=c.editor.getCursor();console.log("Vim Title Edit: cursor at line",d.line),d.line===0&&(console.log("Vim Title Edit: intercepting k, focusing title"),e.preventDefault(),e.stopPropagation(),this.focusTitle())}focusTitle(){let e=this.app.workspace.getActiveViewOfType(n.MarkdownView);if(!e)return;let t=e.containerEl.querySelector(".inline-title");if(!t){new n.Notice("Inline title not found. Enable it in Settings > Editor > Show inline title");return}t.focus();let o=document.createRange();o.selectNodeContents(t),o.collapse(!1);let r=window.getSelection();r==null||r.removeAllRanges(),r==null||r.addRange(o),this.inTitleMode=!0}handleTitleKeydown(e){let i=e.target;if(i.classList.contains("inline-title")){if(e.key==="j"||e.key==="Escape"){e.preventDefault(),e.stopPropagation(),this.returnToEditor();return}if(e.key==="Enter"){e.preventDefault(),e.stopPropagation(),this.saveTitle(i),this.returnToEditor();return}}}returnToEditor(){let e=this.app.workspace.getActiveViewOfType(n.MarkdownView);e&&(e.editor.focus(),e.editor.setCursor({line:0,ch:0}),this.inTitleMode=!1)}async saveTitle(e){var l,c;let i=this.app.workspace.getActiveViewOfType(n.MarkdownView);if(!(i!=null&&i.file))return;let t=(l=e.textContent)==null?void 0:l.trim();if(!t){new n.Notice("Title cannot be empty");return}if(t===i.file.basename)return;let o=((c=i.file.parent)==null?void 0:c.path)||"",r=o?`${o}/${t}.md`:`${t}.md`;try{await this.app.fileManager.renameFile(i.file,r),new n.Notice(`Renamed to: ${t}`)}catch(d){new n.Notice(`Failed to rename: ${d}`)}}};
